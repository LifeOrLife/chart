<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>draw-text</title>
</head>

<body>
    <canvas width="600" height="400" class="box"></canvas>
    <script>
        class startDraw {
            constructor(el, config) {
                this.el = el;
                this.stacks = []; // 用来存储操作步骤
            }
            init() {
                const canvas = this.el;
                let { width, height } = window.getComputedStyle(canvas, null)
                width = parseInt(width)
                height = parseInt(height);
                this.context = canvas.getContext('2d');
                this.width = width;
                this.height = height;
                const context = this.context;
                // 根据设备像素比优化canvas绘图
                const devicePixelRatio = window.devicePixelRatio;
                canvas.style.width = `${width}px`;
                canvas.style.height = `${height}px`;
                if (devicePixelRatio) {
                    canvas.height = height * devicePixelRatio;
                    canvas.width = width * devicePixelRatio;
                    context.scale(devicePixelRatio, devicePixelRatio);
                } else {
                    canvas.width = width;
                    canvas.height = height;
                }
                context.lineWidth = 6;
                context.strokeStyle = 'black';
                context.lineCap = 'round';
                context.lineJoin = 'round';
                this.bindEvent();
                this.addRecall();
            }
            bindEvent() {
                const el = this.el;
                const ctx = this.context;
                el.addEventListener('mousedown', e => {
                    this.canDraw = true;
                    this.x = e.layerX;
                    this.y = e.layerY;
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                })
                el.addEventListener('mousemove', e => {
                    if (this.canDraw) {
                        this.x = e.layerX;
                        this.y = e.layerY;
                        ctx.lineTo(this.x, this.y);
                        ctx.stroke();
                    }
                })
                el.addEventListener('mouseup', e => {
                    this.canDraw = false;
                })
            }
            // 添加撤回操作
            addRecall() {
                document.addEventListener('keydown', e => {
                    if (e.ctrlKey && e.code === 'KeyZ') {
                        console.log('撤回操作')
                    }
                })
            }
            clear() {
                const ctx = this.context
                ctx.clearRect(0, 0, this.width, this.height);
            }
        }
        let el = document.getElementsByClassName('box')[0];
        let pen = new startDraw(el);
        pen.init();
        console.log(pen);
    </script>
</body>

</html>
